<style>
    #map {
        width: 100%;
        height: 450px;
    }
    #basemaps-wrapper {
        background: white;
        padding: 10px;
        width: 100%;
	}
        {#remove all EPA css transitions for leaflet map#}
    * {
         -o-transition-property: none !important;
         -moz-transition-property: none !important;
         -ms-transition-property: none !important;
         -webkit-transition-property: none !important;
         transition-property: none !important;
    }
</style>

<head>
    <!-- jquery -->
    <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

    <!-- local imports -->
    <link rel="stylesheet" href="/static_qed/hms/css/leaflet.css" />
    <script src="/static_qed/hms/js/leaflet.js"></script>
    <script src="/static_qed/hms/js/waterslayer.js"></script>

    <!-- esri imports -->
    <script src="https://unpkg.com/esri-leaflet@2.0.8"></script>
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.4/dist/esri-leaflet-geocoder.css">
    <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.4"></script>

    <!-- datatables import -->
    <link rel="stylesheet" href="https://www.epa.gov/sites/all/libraries/js/datatables/media/css/jquery.dataTables.min.css">
    <script src="https://www.epa.gov/sites/all/libraries/js/datatables/media/js/jquery.dataTables.min.js"></script>


</head>
<body>
  <div class="panel-display panel-1col clearfix" >
    <div class="panel-panel panel-col">

             <p>A watershed is an area of land that captures rainfall and other precipitation and funnels it to a common outlet.
         A comprehensive hierarchical system of Hydrologic Unit Codes (HUCs) was developed by the U.S. Geological Survey
         to catalog watersheds in the United States.</p>

{#    <script src="/static_qed/pisces/scripts/huc250k_4326.js"></script>#}

        <!--- content div -->
        <div class="col-md-10">
          <div class="box multi news">
            <div class="pane-content" id="mapDiv">
              <p><strong>Click the map</strong> to select a HUC12 area of interest.</p>
                <!-- leaflet map div -->
                <div id="map"></div>
                <!-- basemap wrapper -->
                <div id="basemaps-wrapper" class="leaflet-bar">
                  <select name="basemaps" id="basemaps" onChange="changeBasemap(basemaps)">
                    <option value="Imagery">Imagery</option>
                    <option value="Topographic">Topographic</option>
                    <option value="Streets">Streets</option>
                    <option value="NationalGeographic">National Geographic</option>
                    <option value="ShadedRelief">Shaded Relief</option>
                  </select>
                </div>
                <br>

            </div>
          </div>
        </div>

        <script>
            // initialize the map
            var map = L.map('map', { renderer: L.svg({ padding: 100 }) }).setView([39.69, -100.52], 3);
            var currentHucLayer = huc_basemaps.HUC2;       // raster HUC
            L.esri.basemapLayer('Imagery').addTo(map);

            //pop-up
            var popup = L.popup();

            //on map click, pop-up lat long info
            var popup = L.popup();
            function onMapClick(e) {
                popup.setLatLng(e.latlng)
                    .setContent(e.latlng.toString())
                    .openOn(map);
            }

            map.addLayer(currentHucLayer);

            map.on('click', onMapClick);
            map.on('zoomend', updateHucLayer);       // raster HUC

            //style HUC 8 polygons
            var hucStyle = {
                fillColor: '#6baed6',
                weight: .5,
                opacity: 0.9,
                color: 'white',
                fillOpacity: 0.5
            };

            //map search function
            var arcgisOnline = L.esri.Geocoding.arcgisOnlineProvider();

            var searchControl = L.esri.Geocoding.geosearch({
                providers: [
                  arcgisOnline,
                  L.esri.Geocoding.featureLayerProvider({
                      url: 'https://services.arcgis.com/uCXeTVveQzP4IIcx/arcgis/rest/services/gisday/FeatureServer/0/',
                      searchFields: ['Name', 'Organization'],
                      label: 'GIS Day Events',
                      bufferRadius: 5000,
                      formatSuggestion: function(feature){
                          return feature.properties.Name + ' - ' + feature.properties.Organization;
                      }
                  })
                ]
            }).addTo(map);

            //basemap selection toolbar cont.
            var layerESRI = L.esri.basemapLayer('Imagery');
{#            map.addLayer(layerESRI);#}
            var layerLabels;

            //basemap selection toolbar cont.
            function setBasemap(basemap) {
                if (layerESRI) {
                    map.removeLayer(layerESRI);
                    map.removeLayer(currentHucLayer);      // raster HUC
                }
                layerESRI = L.esri.basemapLayer(basemap);
                map.addLayer(layerESRI);
                map.addLayer(currentHucLayer);      // raster HUC
                if (layerLabels) {
                    map.removeLayer(layerLabels);
                }
                if (basemap === 'ShadedRelief' || basemap === 'Imagery' || basemap === 'Terrain') {
                    layerLabels = L.esri.basemapLayer(basemap + 'Labels');
                    map.addLayer(layerLabels);
                }

            }

            //basemap selection toolbar cont.
            function changeBasemap(basemaps) {
                var basemap = basemaps.value;
                setBasemap(basemap);
            }

            // Handling raster HUC data
            function updateHucLayer(){
                var bounds = map.getBounds();
                var zoomLvl = map.getZoom();
                map.removeLayer(currentHucLayer);
                switch(true){
                    case (zoomLvl < 5):
                        currentHucLayer = huc_basemaps.HUC2;
                        break;
                    case (zoomLvl >= 5 && zoomLvl < 6):
                        currentHucLayer = huc_basemaps.HUC4;
                        break;
                    case (zoomLvl >= 6 && zoomLvl < 7):
                        currentHucLayer = huc_basemaps.HUC6;
                        break;
                    case (zoomLvl >= 7 && zoomLvl < 9):
                        currentHucLayer = huc_basemaps.HUC8;
                        break;
                    case (zoomLvl >= 9 && zoomLvl < 10):
                        currentHucLayer = huc_basemaps.HUC10;
                        break;
                    case (zoomLvl >= 10):
                        currentHucLayer = huc_basemaps.HUC12;
                        break;
                    default:
                        currentHucLayer = huc_basemaps.HUC8;
                        break;
                }
                map.addLayer(currentHucLayer);
            }

{#            var huc12Vector = L.tileLayer.wms('');#}

        </script>

    </div>
  </div>

</body>
</html>