<style>

    div.main-column {
        padding-left: 0 !important;
        width: 80% !important;
    }

    #map {
        width: 100%;
        height: 450px;
    }

    #basemaps-wrapper {
        background: white;
        padding: 10px;
        width: 100%;
    }

    {#datatables font size#}
    th {
        font-size: 12px;
    }

    td {
        font-size: 11px;
    }

    {#remove all EPA css transitions for leaflet map#}
    div.mapNoTransition * {
        -o-transition-property: none !important;
        -moz-transition-property: none !important;
        -ms-transition-property: none !important;
        -webkit-transition-property: none !important;
        transition-property: none !important;
        transition: none !important;
    }

    div.fishSearch {
        display: inline-block;
        float: right;
        border-style: solid;
        border-width: 1px;
        width: 33%;
    {#        max-height: 450px;#} margin: 1px 1px;
        max-height: 620px;
    {#        padding: 10px 10px;#} padding: 1.3529em 1em;
    }

    input.fishSearchBox {
        font-size: 12px;
        float: left;
        display: inline-block;
        width: 75%;
        height: 22px;
        border-radius: 3px 0 0 3px !important;
        padding-left: 5px;
    }

    input.fishSearchButton {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB2aWV3Qm94PSIwIDAgMjg5LjEyMjIyIDI4OC4yOTYwOCIgaGVpZ2h0PSIxMnB4IiB3aWR0aD0iMTJweCI+DQo8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjYzLjQzMTIsLTM4OS42MzEyNCkiPg0KPHBhdGggc3Ryb2tlLXdpZHRoPSI5Ljc1NjE3MzEzIiBmaWxsPSIjRkZGIiBkPSJNMjk1LjkzODk5LDQyMi4wODZjLTQzLjI3Mjk5LDQzLjI3Mi00My4zNzg5OSwxMTQuMTU5LTAuMTA1OTgsMTU3LjQzMjAxLDM2LjY2Mjk5LDM2LjY2MzAyLDkzLjIwMTk5LDQyLjI1LDEzNS45MjA5OSwxNi43NjU5OWw3Ni4zNDM5OSw3NC4yMzQ5OGMxMC41MDY5OSwxMC4xOTgsMjcuMDg0OTksOS44MjEwNSwzNy4xMTY5Ny0wLjg0Mzk5LDEwLjAzMzAyLTEwLjY2NDk4LDkuNzcwMDItMjcuNDQ1OTktMC43Mzc5Ny0zNy42NDM5OGwtNzUuMTgyOTgtNzIuODY0MDJjMjYuMzYwOTktNDIuODQ2OTgsMjEuMDA3OTktMTAwLjA0NDk4LTE2LjAyODAyLTEzNy4wODA5OS00My4yNzI5OC00My4yNzMwMS0xMTQuMDU0OTktNDMuMjczMDEtMTU3LjMyNywwem0zMS43Mzg5OSwzMS43MzkwMWMyNi4xMDIwMi0yNi4xMDIwMiw2Ny43NDYwMy0yNi4xMDIwMiw5My44NDgwMiwwLDI2LjEwMTk5LDI2LjEwMTk5LDI2LjEwMTk5LDY3Ljc0NTk4LDAsOTMuODQ3OTYtMjYuMTAxOTksMjYuMTAyMDYtNjcuNzQ2LDI2LjEwMjA2LTkzLjg0ODAyLDAtMjYuMTAxOTktMjYuMTAxOTktMjYuMTAxOTktNjcuNzQ1OTcsMC05My44NDc5NnoiLz4NCjwvZz4NCjwvc3ZnPg==");
        background-color: #02bfe7;
        background-repeat: no-repeat;
        background-size: 10px 10px;
        background-position: 50%;
        border-color: #02bfe7;
        float: left;
        display: inline-block;
        width: 10px;
        height: 22px;
        margin-left: 0 !important;
        border-radius: 0 3px 3px 0 !important;
    }

    #fishTable thead * {
        font-size: 10px;
    }

    #fishTable tbody {
        cursor: pointer;
    }

    #fishTable thead *, tr *, td * {
        border: 0 !important;
        text-align: center !important;
    }

    #fishTable td * {
        width: 50% !important;
    }

    #fishTable tr:hover td {
        background-color: #02bfe7;
    }

    tr.selected_fish td {
        background-color: #6baed6 !important;
    }

    div.fishDetails {
        display: inline-block;
        font-size: 12px;
        padding: 5px 5px;
        margin-top: 10px;
        width: 65%;
    }

    {#    div.fishDetails p {#}
    {#        background-color: #DBF1FF;#}
    {#        padding: 0 5px;#}
    {#        border-width: 1px;#}
    {#        border-color: black;#}
    {#        border-style: solid;#}
    {#    }#}

    table.fishDetails {
        line-height: 12px;
        width: 100%;
        border-color: black;
        border-style: solid;
        border-width: 1px;
        background-color: #DBF1FF;
    }

    table.fishDetails col:nth-child(even) {
        background-color: white !important;
        width: 15%;
    }

    table.fishDetails col:last-child {
        width: 45%;
    }

    .link_image {
        max-width: 25px;
        width: 100%;
        margin: 5px 5px;
    }

    .fish_links {
        display: flex;
        padding: 5px;
    }

    #fish_weight_length * label {
        float: left !important;
        display: inline-block !important;
    }

    div.dataTables_scrollBody {
        max-height: 470px !important;
    }

    {#    Loader    #}

    #loader {
        position: absolute;
        left: 50%;
        top: 85%;
        z-index: 999;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 100px;
        height: 100px;
        -webkit-animation: spin 1s linear infinite;
        animation: spin 1s linear infinite;
        transition: ease-in-out;
    }

    #loader_background {
        background-color: rgba(255, 255, 255, 0.5);
        z-index: 995;
        position: absolute;
        height: 1000px;
        width: 100%;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    /* Add animation to "page content" */
    {#    .animate-bottom {#}
    {#        position: relative;#}
    {#        -webkit-animation-name: animatebottom;#}
    {#        -webkit-animation-duration: 1s;#}
    {#        animation-name: animatebottom;#}
    {#        animation-duration: 1s#}
    {#    }#}
    {##}
    {#    @-webkit-keyframes animatebottom {#}
    {#        from {#}
    {#            bottom: -100px;#}
    {#            opacity: 0#}
    {#        }#}
    {#        to {#}
    {#            bottom: 0px;#}
    {#            opacity: 1#}
    {#        }#}
    {#    }#}
    {##}
    {#    @keyframes animatebottom {#}
    {#        from {#}
    {#            bottom: -100px;#}
    {#            opacity: 0#}
    {#        }#}
    {#        to {#}
    {#            bottom: 0;#}
    {#            opacity: 1#}
    {#        }#}
    {#    }#}

</style>

<head>

    <!-- jquery -->
    <script src="http://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

    <!-- datatables import -->
    <link rel="stylesheet"
          href="https://www.epa.gov/sites/all/libraries/js/datatables/media/css/jquery.dataTables.min.css">
    <script src="https://www.epa.gov/sites/all/libraries/js/datatables/media/js/jquery.dataTables.min.js"></script>

    <!-- local js -->
    <script src="/static_qed/pisces/scripts/huc250k_4326_sp.js"></script>
    <script src="/static_qed/pisces/scripts/pisces_datatable.js"></script>

</head>

<body>
<div class="panel-display panel-1col clearfix">
    <div class="panel-panel panel-col">

        <!-- leaflet import -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css"/>
        <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
        <script src="https://cdn.jsdelivr.net/leaflet.esri/2.0.1/esri-leaflet.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.1.1/esri-leaflet-geocoder.css">
        <script src="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.1.1/esri-leaflet-geocoder.js"></script>


        <!--- content div -->
        <div class="col-md-10">
            <div id="loader" style="display:none;"></div>
            <div id="loader_background" style="display:none"></div>
            <div class="box multi news">
                <div class="pane-content" id="mapDiv"
                     style="display: inline-block; float:left; width: 65%; height: 625px;">
                    <p><strong>Select a HUC 8 watershed</strong> on the map to view a list of fish species associated
                        with the area.</p>
                    <!-- leaflet map div -->
                    <div id="map" class="mapNoTransition"></div>
                    <!-- basemap wrapper -->
                    <div id="basemaps-wrapper" class="leaflet-bar">
                        <select name="basemaps" id="basemaps" onChange="changeBasemap(basemaps)" title="Base Map">
                            <option value="Topographic">Topographic</option>
                            <option value="Imagery">Imagery</option>
                            <option value="Streets">Streets</option>
                            <option value="NationalGeographic">National Geographic</option>
                            <option value="ShadedRelief">Shaded Relief</option>
                        </select>
                    </div>
                    <br>
                </div>
                <div class="fishSearch">
                    <div>
                        <input class="fishSearchBox" type="text" name="fish_search"
                               placeholder="Search for fish species..." title="Fish common or scientific name">
                        <input class="fishSearchButton" type="button" title="Search">
                    </div>
                    <div class="fishTable" style="display:none;">
                        <h5 style="padding: 0 0 0 15%; font-size: smaller; float:left;" align="center">Fish in selected
                            HUC</h5>
                        <table id="fishTable" class="display compact hover" cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th>Common Name</th>
                                <th>Scientific Name</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div id="focusDetails" tabindex="-1"></div>
                <div id="selectedFishTable" class="fishDetails"></div>
                <div id="fish_weight_length"
                     style="float:right; width:33%; font-size:12px; margin-top:55px; border-color: black; border-width: 1px; border-style: solid; padding: 5px 5px 5px 5px;">
                    <h4 style="padding-left: 4px">Weight - Length Calculator</h4>
                    <div style="padding: 10px 10px;margin-bottom: 10px;"><label for="fish_weight">Weight
                        (g): </label><input style="margin: 0 10px; width:65%; padding-left: 3px; float: right;"
                                            type="text"
                                            id="fish_weight"
                                            title="Fish Weight" placeholder="Fish weight..."></div>
                    <div style="padding: 0px 10px;margin-bottom: 10px;"><label for="fish_length">Length
                        (cm): </label><input style="margin: 0 10px; width:65%; padding-left: 3px; float: right;"
                                             type="text"
                                             id="fish_length"
                                             title="Fish Length" placeholder="Fish length..."></div>
                </div>
            </div>
        </div>

        <script>

            //Weight-length coefficients
            var a = 0;
            var b = 0;
            var c = 0;
            var d = 0;

            $(document).ready(function () {
                $('#fishTable').on('click', 'tr', function () {
                    startLoad();
                    var e = this;
                    setTimeout(function () {
                        setFishTable(e);
                    }, 1);
                });

                $('.fishSearchButton').on('click', function () {
                    startLoad();
                    setTimeout(function () {
                        searchForFish()
                    }, 1);
                });
                $('#fish_weight').keyup(calculateFishLength);
                $('#fish_length').keyup(calculateFishWeight);
            });

            $('#fish_weight_length').hide();
            $('.fishTable').closest('div').hide();

            function setFishTable(e) {
                $('#fishTable').DataTable().rows().nodes().to$().removeClass('selected_fish');
                var fish = $('#fishTable').DataTable().row(e).data();
                var details = getFishDetails(fish);
                setFishDetails(details["species"][0]);

                a = details["species"][0]["w_l_a"];
                b = details["species"][0]["w_l_b"];
                c = details["species"][0]["l_w_c"];
                d = details["species"][0]["l_w_d"];

                $('#fishTable').DataTable().row(e).nodes().to$().addClass('selected_fish');
                $('#fish_weight_length').show();
                $('#selectedFishTable').show();
                $('#fish_weight_length').show();

                console.log(details["species"][0]["speciesid"]);
                searchFishHuc(details["species"][0]["speciesid"]);
                endLoad();
            }

            //style HUC 8 polygon
            function getColor(d) {
                return d > 110 ? '#084594' :
                    d > 86 ? '#2171b5' :
                        d > 63 ? '#4292c6' :
                            d > 41 ? '#6baed6' :
                                d > 20 ? '#9ecae1' :
                                    d > -1 ? '#c6dbef' :
                                        'red';
            }

            //style HUC 8 polygon cont.
            function hucStyle(feature) {
                return {
                    fillColor: getColor(feature.properties.NumbSpc),
                    weight: .5,
                    opacity: 0.9,
                    color: 'black',
                    fillOpacity: 0.5
                };
            }

            //style selected HUC 8 polygon
            function selectHUCs(hucs) {
                console.log("highlighted hucs: " + hucs);
                resetHUCLayer();
                //  properties of highlighted HUC
                var layerGroup = [];
                huc8Layer.eachLayer(function (layer) {
                    $.each(hucs, function (index, value) {
                        if (value === layer.feature.properties.HUC_CODE)
                            layer.setStyle({color: 'black', weight: 2.5, fillColor: '#02bfe7', fillOpacity: 0.6});
                        if (value === layer.feature.properties.HUC_CODE)
                            layerGroup.push(layer);
                        layer.bringToFront();
                    });
                });
                map.fitBounds(L.featureGroup(layerGroup).getBounds());
            }

            function resetHUCLayer() {
                huc8Layer.eachLayer(function (layer) {
                    huc8Layer.resetStyle(layer);
                });
                {#                document.getElementsByClassName('#selectedFishTable').innerHTML = "";#}

            }

            var currentHUC = null;

            function onEachFeature(feature, layer) {
                layer.on('click', function (e) {
                    $('.fishSearchBox').val("");
                    if (this.currentHUC !== feature.properties.HUC_CODE || this.currentHUC === null) {
                        this.currentHUC = feature.properties.HUC_CODE;
                        var hucs = [];
                        hucs.push(feature.properties.HUC_CODE);
                        selectHUCs(hucs);
                        //var data = getHUCFishData(feature.properties.HUC_CODE);
                        getFishDataonMapClick(feature.properties.HUC_CODE);
                    }
                    else {
                        $('.fishTable').closest('div').hide();
                        $('#fish_weight_length').hide();
                        document.getElementById('selectedFishTable').innerHTML = null;
                        resetHUCLayer();
                        this.currentHUC = null;
                    }

                });
            }

            // initialize the map
            var map = L.map('map', {renderer: L.svg({padding: 100})}).setView([40.265306, -98.623725], 4);

            // load basemap
            L.esri.basemapLayer('Topographic')
                .addTo(map);

            // load huc watershed boundaries
            var huc8Layer = L.geoJson(huc8s, {
                style: hucStyle,
                onEachFeature: onEachFeature
            }).addTo(map);

            //basemap selection toolbar
            var layerESRI = L.esri.basemapLayer('Imagery');
            var layerLabels;

            function setBasemap(basemap) {
                if (layerESRI) {
                    map.removeLayer(layerESRI);
                }
                layerESRI = L.esri.basemapLayer(basemap);
                map.addLayer(layerESRI);
                if (layerLabels) {
                    map.removeLayer(layerLabels);
                }
                if (basemap === 'ShadedRelief' || basemap === 'Imagery' || basemap === 'Terrain') {
                    layerLabels = L.esri.basemapLayer(basemap + 'Labels');
                    map.addLayer(layerLabels);
                }
            }

            function changeBasemap(basemaps) {
                var basemap = basemaps.value;
                setBasemap(basemap);
            }

            // -------- FISH Functions ---------- //

            function getFishDataonMapClick(huc8) {
                var data = getFishData(huc8);
                //var data = getTESTFishData();
            }

            function getFishData(huc8) {
                $.ajax({
                    type: "GET",
                    url: "/pisces/rest/api/v1/fish/hucs/" + huc8,
                    crossDomain: true,
                    async: false,
                    success: function (data) {
                        console.log(data);
                        populateFishTable(data);
                    },
                    error: function (jqXHR, status) {
                        console.log("ERROR: failed to get fish data for huc: " + huc8);
                        $('#error_msg').html("Error: failed to get fish data for the selected huc.");
                        return null;
                    }
                });
            }

            function getTESTFishData() {
                var testFishData = {
                    "huc": "04030101",
                    "species": [
                        {
                            "speciesid": 14,
                            "common_name": "alewife",
                            "scientific_name": "pseudoharengus",
                            "genus": "Alosa"
                        },
                        {
                            "speciesid": 19,
                            "common_name": "rock bass",
                            "scientific_name": "rupestris",
                            "genus": "Ambloplites"
                        },
                        {
                            "speciesid": 24,
                            "common_name": "black bullhead",
                            "scientific_name": "melas",
                            "genus": "Ameiurus"
                        },
                        {
                            "speciesid": 25,
                            "common_name": "yellow bullhead",
                            "scientific_name": "natalis",
                            "genus": "Ameiurus"
                        },
                        {
                            "speciesid": 26,
                            "common_name": "brown bullhead",
                            "scientific_name": "nebulosus",
                            "genus": "Ameiurus"
                        },
                        {
                            "speciesid": 39,
                            "common_name": "american eel",
                            "scientific_name": "rostrata",
                            "genus": "Anguilla"
                        },
                        {
                            "speciesid": 51,
                            "common_name": "central stoneroller",
                            "scientific_name": "anomalum",
                            "genus": "Campostoma"
                        },
                        {
                            "speciesid": 52,
                            "common_name": "largescale stoneroller",
                            "scientific_name": "oligolepis",
                            "genus": "Campostoma"
                        },
                        {
                            "speciesid": 56,
                            "common_name": "goldfish",
                            "scientific_name": "auratus",
                            "genus": "Carassius"
                        },
                        {
                            "speciesid": 64,
                            "common_name": "longnose sucker",
                            "scientific_name": "catostomus",
                            "genus": "Catostomus"
                        },
                        {
                            "speciesid": 67,
                            "common_name": "white sucker",
                            "scientific_name": "commersonii",
                            "genus": "Catostomus"
                        },
                        {
                            "speciesid": 97,
                            "common_name": "northern redbelly dace",
                            "scientific_name": "eos",
                            "genus": "Chrosomus"
                        },
                        {
                            "speciesid": 98,
                            "common_name": "southern redbelly dace",
                            "scientific_name": "erythrogaster",
                            "genus": "Chrosomus"
                        },
                        {
                            "speciesid": 99,
                            "common_name": "finescale dace",
                            "scientific_name": "neogaeus",
                            "genus": "Chrosomus"
                        },
                        {
                            "speciesid": 109,
                            "common_name": "redside dace",
                            "scientific_name": "elongatus",
                            "genus": "Clinostomus"
                        },
                        {
                            "speciesid": 111,
                            "common_name": "cisco",
                            "scientific_name": "artedi",
                            "genus": "Coregonus"
                        },
                        {
                            "speciesid": 113,
                            "common_name": "lake whitefish",
                            "scientific_name": "clupeaformis",
                            "genus": "Coregonus"
                        }
                    ]
                };
                populateFishTable(testFishData);
            }

            function populateFishTable(data) {
                $('#fishTable').DataTable().destroy();
                $('#fishTable').empty();
                var fishData = data["species"];
                var config = {
                    data: fishData,
                    "columns": [
                        {
                            data: "speciesid",
                            title: "Species ID",
                            name: "species_id"
                        },
                        {
                            data: "common_name",
                            title: "Common Name",
                            name: "common_name"
                        },
                        {
                            data: "scientific_name",
                            title: "Scientific Name",
                            name: "scientific_name"
                        },
                        {
                            data: "genus",
                            title: "Genus",
                            name: "genus"
                        }
                    ],
                    "columnDefs": [
                        {
                            "render": function (data, type, row) {
                                return row["genus"] + " " + data;
                            },
                            "targets": 2
                        },
                        {
                            "targets": [0, 3],
                            "visible": false
                        }
                    ],
                    scrollY: true,
                    searching: false,
                    paging: false,
                    bInfo: false,
                    "order": [[0, 'asc']]
                };
                $('.fishTable').closest('div').show();
                $('#fishTable').DataTable(config);
            }

            function getFishDetails(fish) {
                $.ajax({
                    type: "GET",
                    url: "/pisces/rest/api/v1/fish/properties/" + fish["speciesid"].toString(),
                    crossDomain: true,
                    async: false,
                    success: function (data) {
                        console.log(data);
                        return data;
                    },
                    error: function (jqXHR, status) {
                        console.log("ERROR: failed to get fish detail for speciesid: " + fish["speciesid"]);
                        $('#error_msg').html("Error: failed to get fish details for the selected fish.");
                        return null;
                    }
                });
                {#                return {#}
                {#                    "speciesid":#}
                {#                        "14",#}
                {#                    "species":#}
                {#                        [#}
                {#                            {#}
                {#                                "speciesid": 14,#}
                {#                                "genusid": 6,#}
                {#                                "genus": "Alosa",#}
                {#                                "species": "pseudoharengus",#}
                {#                                "commonname": "alewife",#}
                {#                                "group": "Clupeids",#}
                {#                                "native": "Y",#}
                {#                                "pfg_page": "148",#}
                {#                                "sportfishing": "1",#}
                {#                                "nongame": "0",#}
                {#                                "subsis_fish": "1",#}
                {#                                "pollut_tol": "",#}
                {#                                "max_length": 37.5,#}
                {#                                "mean_length": 10.8,#}
                {#                                "mean_weight": 10.8,#}
                {#                                "thinning": 0.569,#}
                {#                                "thin_adj": 0,#}
                {#                                "max_age": 6,#}
                {#                                "w_l_a": 55.1,#}
                {#                                "w_l_b": 0.312,#}
                {#                                "l_w_c": 0.00000268,#}
                {#                                "l_w_d": 3.2,#}
                {#                                "regress": "0",#}
                {#                                "rarity": 3,#}
                {#                                "caves": "",#}
                {#                                "springs": "",#}
                {#                                "headwaters": "",#}
                {#                                "creeks": "",#}
                {#                                "small_riv": "",#}
                {#                                "med_riv": "",#}
                {#                                "lge_riv": "A",#}
                {#                                "lk_imp_pnd": "A",#}
                {#                                "swp_msh_by": "",#}
                {#                                "coast_ocea": "A",#}
                {#                                "riffles": "",#}
                {#                                "run_flopool": "",#}
                {#                                "pool_bckwtr": "A",#}
                {#                                "benthic": "",#}
                {#                                "surface": "",#}
                {#                                "nrshre_litt": "",#}
                {#                                "opnwtr_pelag": "A",#}
                {#                                "mud_slt_det": "",#}
                {#                                "sand": "",#}
                {#                                "gravel": "",#}
                {#                                "rck_rub_bol": "",#}
                {#                                "vegatation": "",#}
                {#                                "wdyd_brush": "",#}
                {#                                "clearwater": "",#}
                {#                                "turbidwater": "",#}
                {#                                "warmwater": "",#}
                {#                                "coolwater": "A",#}
                {#                                "coldwater": "",#}
                {#                                "lowlands_lgr": "",#}
                {#                                "uplands_hgr": "",#}
                {#                                "locat_notes": "",#}
                {#                                "habit_notes": ""#}
                {#                            }#}
                {#                        ]#}
                {#                };#}
            }

            function setFishDetails(details) {
                document.getElementById('focusDetails').focus();

                var cName = capitalize_Words(details["commonname"]);
                var sName = capitalize_Words(details["genus"] + " " + details["species"]);
                var d = document.getElementById('selectedFishTable');

                // biogeography
                var native = (details["native"] === "Y") ? "Native" : "Non-Native";

                // gradient
                var gradient = [];
                if (details["lowlands_lgr"] === "A") gradient.push("Lowlands");
                if (details["upland_hgr"] === "A") gradient.push("Uplands");

                // thermal
                var thermal = [];
                if (details["warmwater"] === "A") thermal.push("Warmwater");
                if (details["coolwater"] === "A") thermal.push("Coolwater");
                if (details["coldwater"] === "A") thermal.push("Coldwater");

                // clarity
                var clarity = [];
                if (details["clearwater"] === "A") clarity.push("Clearwater");
                if (details["turbidwater"] === "A") clarity.push("Turbidwater");

                // system
                var system = [];
                if (details["caves"] === "A") system.push("Caves");
                if (details["springs"] === "A") system.push("Springs");
                if (details["headwaters"] === "A") system.push("Headwaters");
                if (details["creeks"] === "A") system.push("Creeks");
                if (details["small_riv"] === "A") system.push("Small Rivers");
                if (details["med_riv"] === "A") system.push("Medium Rivers");
                if (details["lge_riv"] === "A") system.push("Large Rivers");
                if (details["lk_imp_pnd"] === "A") system.push("Lakes/Impoundments/Ponds");
                if (details["swp_msh_by"] === "A") system.push("Swamps/Marshes/Bayous");
                if (details["coast_ocea"] === "A") system.push("Coasts/Oceans");
                if (details["riffles"] === "A") system.push("Riffles");

                // lotic habitat
                var lotic = [];
                if (details["run_flopool"] === "A") lotic.push("Running/Flow Pools");
                if (details["pool_bckwtr"] === "A") lotic.push("Pools/Backwaters");

                // water column
                var column = [];
                if (details["benthic"] === "A") column.push("Benthic");
                if (details["surface"] === "A") column.push("Surface");
                if (details["nrshre_litt"] === "A") column.push("Nearshore/???");
                if (details["opnwtr_pelag"] === "A") column.push("Openwater/???");

                // substrate
                var substrate = [];
                if (details["mud_slt_det"] === "A") substrate.push("Mud/Silt/Detritus");
                if (details["sand"] === "A") substrate.push("Sand");
                if (details["gravel"] === "A") substrate.push("Gravel");
                if (details["rck_rub_bol"] === "A") substrate.push("Rocks/Rubble/Boulders");
                if (details["vegatation"] === "A") substrate.push("Vegetation");
                if (details["wdyd_brush"] === "A") substrate.push("???/Brush");

                // links
                var google_link = "https://www.google.com/search?tbm=isch&q=" + cName.replace(" ", "+");
                var wiki_link = "https://en.wikipedia.org/wiki/" + cName.replace(" ", "_");

                d.innerHTML = '<h4>' + capitalize_Words(cName) + '</h4>' +
                    '<h5>' + capitalize_Words(sName) + '</h5><p>' +
                    '<table class="fishDetails"><col><col><col><col><tr><td>Group</td><td>' + details["group"] + '</td><td>Biogeography</td><td>' + native + '</td></tr>' +
                    '<tr><td>Max Length (cm)</td><td> ' + details["max_length"] + ' </td><td>System</td><td>' + system.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>Mean Weight (g)</td><td>' + details["mean_weight"] + '</td><td>Lotic Habitat</td><td>' + lotic.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>Mean Length (cm)</td><td>' + details["mean_length"] + '</td><td>Water Column</td><td>' + column.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>Max Age (yr)</td><td>' + details["max_age"] + '</td><td>Substrate</td><td>' + substrate.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>A (W=A*L<sup>B</sup>)</td><td>' + details["w_l_a"] + '</td><td>Water Clarity</td><td>' + clarity.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>B (W=A*L<sup>B</sup>)</td><td>' + details["w_l_b"] + '</td><td>Thermal</td><td>' + thermal.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>C (L=C*W<sup>D</sup>)</td><td>' + details["l_w_c"] + '</td><td>Gradient</td><td>' + gradient.toString().replace(',', ', ') + '</td></tr>' +
                    '<tr><td>D (L=C*W<sup>D</sup>)</td><td>' + details["l_w_d"] + ' </td><td>Location Notes</td><td>' + details["locat_notes"] + '</td></tr>' +
                    '<tr><td>Rarity</td><td>' + details["rarity"] + '</td><td>Habitat Notes</td><td>' + details["habit_notes"] + '</td></tr></table>' +
                    '<div class="fish_links">Links: <a href="' + google_link + '" target="_blank"><img class="link_image" src="/static_qed/pisces/images/google_logo.png" alt="Google Images" title="Link to Google Images"></a>' +
                    '<a href="' + wiki_link + '" target="_blank"><img class="link_image" src="/static_qed/pisces/images/wikipedia_logo.png" alt="Wikipedia page" title="Link to Wikipedia page"></a></div>'
                ;
            }

            function capitalize_Words(str) {
                return str.replace(/\w\S*/g, function (txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            }

            function calculateFishWeight() {
                // Get coefficients for selected fish.
                {#                var A = 0.5;#}
                {#                var B = 0.9;#}
                var L = $('#fish_length').val();
                if ($.isNumeric(L) && L !== "") {
                    var length = a * Math.pow(L, b);
                    $('#fish_weight').val(length);
                }
                else {
                    $('#fish_weight').val("");
                }
            }

            function calculateFishLength() {
                // Get coefficients for selected fish.
                {#                var A = 0.3;#}
                {#                var B = 0.4;#}
                var W = $('#fish_weight').val();
                if ($.isNumeric(W) && W !== "") {
                    var weight = c * Math.pow(W, d);
                    $('#fish_length').val(weight);
                }
                else {
                    $('#fish_length').val("");
                }
            }

            function searchForFish() {
                var fish = $('.fishSearchBox').val();
                resetHUCLayer();
                console.log(fish);
                var fishrequest = {"search_string": fish};
                $.ajax({
                    type: "POST",
                    url: "/pisces/rest/api/v1/fish/properties/names",
                    data: fishrequest,
                    crossDomain: true,
                    success: function (data) {
                        populateFishTable(data)
                    },
                    error: function (jqXHR, status) {
                        console.log("ERROR: failed to get fish data from search: " + fish);
                        $('#error_msg').html("Error: failed to query for provided string.");
                        return null;
                    }
                });
                {#                var testData = {#}
                {#                    "search_string": "bass",#}
                {#                    "species": [#}
                {#                        {#}
                {#                            "speciesid": 16,#}
                {#                            "common_name": "shadow bass",#}
                {#                            "scientific_name": "ariommus",#}
                {#                            "genus": "Ambloplites"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 18,#}
                {#                            "common_name": "ozark bass",#}
                {#                            "scientific_name": "constellatus",#}
                {#                            "genus": "Ambloplites"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 19,#}
                {#                            "common_name": "rock bass",#}
                {#                            "scientific_name": "rupestris",#}
                {#                            "genus": "Ambloplites"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 611,#}
                {#                            "common_name": "shoal bass",#}
                {#                            "scientific_name": "cataractae",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 612,#}
                {#                            "common_name": "redeye bass",#}
                {#                            "scientific_name": "coosae",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 613,#}
                {#                            "common_name": "smallmouth bass",#}
                {#                            "scientific_name": "dolomieu",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 615,#}
                {#                            "common_name": "suwannee bass",#}
                {#                            "scientific_name": "notius",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 616,#}
                {#                            "common_name": "spotted bass",#}
                {#                            "scientific_name": "punctulatus",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 618,#}
                {#                            "common_name": "largemouth bass",#}
                {#                            "scientific_name": "salmoides",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 619,#}
                {#                            "common_name": "florida largemouth bass",#}
                {#                            "scientific_name": "salmoides floridanus",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 620,#}
                {#                            "common_name": "northern largemouth bass",#}
                {#                            "scientific_name": "salmoides salmoides",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 621,#}
                {#                            "common_name": "black bass",#}
                {#                            "scientific_name": "sp.",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 628,#}
                {#                            "common_name": "white bass",#}
                {#                            "scientific_name": "chrysops",#}
                {#                            "genus": "Morone"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 630,#}
                {#                            "common_name": "yellow bass",#}
                {#                            "scientific_name": "mississippiensis",#}
                {#                            "genus": "Morone"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 631,#}
                {#                            "common_name": "striped bass",#}
                {#                            "scientific_name": "saxatilis",#}
                {#                            "genus": "Morone"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 17,#}
                {#                            "common_name": "roanoke bass",#}
                {#                            "scientific_name": "cavifrons",#}
                {#                            "genus": "Ambloplites"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 103,#}
                {#                            "common_name": "butterfly peacock bass",#}
                {#                            "scientific_name": "ocellaris",#}
                {#                            "genus": "Cichla"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 614,#}
                {#                            "common_name": "alabama bass",#}
                {#                            "scientific_name": "henshalli",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 617,#}
                {#                            "common_name": "northern spotted bass",#}
                {#                            "scientific_name": "punctulatus punctulatus",#}
                {#                            "genus": "Micropterus"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 622,#}
                {#                            "common_name": "guadalupe bass",#}
                {#                            "scientific_name": "treculii",#}
                {#                            "genus": "Micropterus"#}
                {#                        }#}
                {#                    ]#}
                {#                };#}
                {#                populateFishTable(testData);#}
                $('#selectedFishTable').hide();
                $('#fish_weight_length').hide();
                endLoad();
            }

            function searchFishHuc(speciesID) {
                {#                var testHUCS = {#}
                {#                    "speciesid": "14",#}
                {#                    "hucs": [#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01000000"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01010004"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01020005"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01030003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01040002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01050001"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01050002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01050003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01060001"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01060002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01060003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01070002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01070003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01080205"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01080207"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01090001"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01090002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01090003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01090004"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01090005"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100001"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100002"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100003"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100004"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100005"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "01100006"#}
                {#                        },#}
                {#                        {#}
                {#                            "speciesid": 14,#}
                {#                            "huc": "02010000"#}
                {#                        }]#}
                {#                };#}
                {#                console.log ("speciesID: " + speciesID);#}
                {#                var hucList = testHUCS["hucs"].map(function (h) {#}
                {#                    return h["huc"];#}
                {#                });#}
                {#                selectHUCs(hucList);#}

                $.ajax({
                    type: "GET",
                    url: "/pisces/rest/api/v1/hucs/fish/" + speciesID,
                    {#                    data: speciesID,#}
                    crossDomain: true,
                    async: false,
                    success: function (data) {
                        var hucList = details["species"].map(function (h) {
                            return h["huc"];
                        });
                        selectHUCs(hucList)
                    },
                    error: function (jqXHR, status) {
                        console.log("ERROR: failed to get huc list for fish:" + speciesID);
                        $('#error_msg').html("Error: failed to get huc list for the specified fish.");
                        return null;
                    }
                });
            }

            function startLoad() {
                document.getElementById("loader").style.display = "block";
                document.getElementById("loader_background").style.display = "block";
            }

            function endLoad() {
                document.getElementById("loader").style.display = "none";
                document.getElementById("loader_background").style.display = "none";
            }

        </script>

    </div>
</div>

</body>
</html>