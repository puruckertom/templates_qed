<style>
    #map {
        width: 100%;
        height: 450px;
    }
    #basemaps-wrapper {
        background: white;
        padding: 10px;
        width: 100%;
	}
    {#datatables font size#}
    th {
        font-size: 12px;
    }
    td {
        font-size: 11px;
    }
        {#remove all EPA css transitions for leaflet map#}
    * {
         -o-transition-property: none !important;
         -moz-transition-property: none !important;
         -ms-transition-property: none !important;
         -webkit-transition-property: none !important;
         transition-property: none !important;
    }
</style>

<head>

    <!-- jquery -->
    <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

    <!-- datatables import -->
    <link rel="stylesheet" href="https://www.epa.gov/sites/all/libraries/js/datatables/media/css/jquery.dataTables.min.css">
    <script src="https://www.epa.gov/sites/all/libraries/js/datatables/media/js/jquery.dataTables.min.js"></script>

    <!-- local js -->
    <script src="/static_qed/pisces/scripts/huc250k_4326_sp.js"></script>
    <script src="/static_qed/pisces/scripts/pisces_datatable.js"></script>

</head>

<body>
  <div class="panel-display panel-1col clearfix" >
    <div class="panel-panel panel-col">

    <!-- leaflet import -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/leaflet.esri/2.0.1/esri-leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.1.1/esri-leaflet-geocoder.css">
	<script src="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.1.1/esri-leaflet-geocoder.js"></script>


        <!--- content div -->
        <div class="col-md-10">
          <div class="box multi news">
            <div class="pane-content" id="mapDiv">
              <p><strong>Select a HUC 8 watershed</strong> on the map to view a list of fish species associated with the area.</p>
                <!-- leaflet map div -->
                <div id="map"></div>
                <!-- basemap wrapper -->
                <div id="basemaps-wrapper" class="leaflet-bar">
                  <select name="basemaps" id="basemaps" onChange="changeBasemap(basemaps)">
                    <option value="Topographic">Topographic</option>
                    <option value="Imagery">Imagery</option>
                    <option value="Streets">Streets</option>
                    <option value="NationalGeographic">National Geographic</option>
                    <option value="ShadedRelief">Shaded Relief</option>
                  </select>
                </div>
                <br>
                <!-- datatables div -->
                <div>
                <table id="fish_data_table" width="90%"></table>
                </div>
            </div>
          </div>
         </div>


        <script>

        //style HUC 8 polygon
        function getColor(d) {
            return d > 110   ? '#084594' :
                   d > 86   ? '#2171b5' :
                   d > 63   ? '#4292c6' :
                   d > 41   ? '#6baed6' :
                   d > 20   ? '#9ecae1' :
                   d > -1   ? '#c6dbef' :
                              'red';
        }

        //style HUC 8 polygon cont.
        function hucStyle(feature) {
            return {
                fillColor: getColor(feature.properties.NumbSpc),
                weight: .5,
                opacity: 0.9,
                color: 'white',
                fillOpacity: 0.5
            };
        }

        //style selected HUC 8 polygon
        function selectHUCs(hucs)
        {
            resetHUCLayer();
            //  properties of highlighted HUC
            huc8Layer.eachLayer(function (layer) {
                if (hucs == layer.feature.properties.HUC_CODE)
                    layer.setStyle({ color: 'black', weight: 2.5, fillColor: '#02bfe7', fillOpacity: 0.6 });
                if (hucs == layer.feature.properties.HUC_CODE)
                    layer.bringToFront();
                });
        }

        //get fish json data for selected HUC
        function getHUCFishData(hucs)
        {
            var url = "http://127.0.0.1:8000/fishhucs/" + hucs;
            $.ajax({
                type:"GET",
                url: url,
                dataType: "json",
                success: function(data, status, jqXHR) {
                    initDT(fish_by_huc_columns, data);
                    return data;
                },
                error: function(jqXHR, status) {
                    return null;
                }
            })
        }

        //get fish json data for selected HUC
        function resetHUCLayer()
        {
            huc8Layer.eachLayer(function (layer) {
                huc8Layer.resetStyle(layer);
            });
        }

        //Setup on click method for each huc8 feature
        function onEachFeature(feature, layer) {
            layer.on('click', function (e) {
                selectHUCs(feature.properties.HUC_CODE);
                var data = getHUCFishData(feature.properties.HUC_CODE);
                //initDT(fish_by_huc_columns, data);
                //alert(e.latlng.toString());
            });
        }


            // initialize the map
            var map = L.map('map', { renderer: L.svg({ padding: 100 }) }).setView([33.95, -83.38], 8);

            // load basemap
            L.esri.basemapLayer('Topographic')
            .addTo(map);

            // load huc watershed boundaries
            var huc8Layer = L.geoJson(huc8s, {
                style: hucStyle,
                onEachFeature: onEachFeature,
            }).addTo(map);


            //basemap selection toolbar
            var layerESRI = L.esri.basemapLayer('Imagery');
            var layerLabels;

            function setBasemap(basemap) {
                if (layerESRI) {
                    map.removeLayer(layerESRI);
                }
                layerESRI = L.esri.basemapLayer(basemap);
                map.addLayer(layerESRI);
                if (layerLabels) {
                    map.removeLayer(layerLabels);
                }
                if (basemap === 'ShadedRelief' || basemap === 'Imagery' || basemap === 'Terrain') {
                    layerLabels = L.esri.basemapLayer(basemap + 'Labels');
                    map.addLayer(layerLabels);
                }
            }

            function changeBasemap(basemaps) {
                var basemap = basemaps.value;
                setBasemap(basemap);
            }

        </script>

    </div>
  </div>

</body>
</html>